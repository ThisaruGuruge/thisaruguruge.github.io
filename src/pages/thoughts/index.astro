---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import BreadcrumbSchema from '../../components/schemas/BreadcrumbSchema.astro';
import { getCollection } from 'astro:content';

let posts = await getCollection('blog');
posts = posts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

const site = 'https://thisaru.me';
const canonicalURL = new URL(Astro.url.pathname, site);

// Create breadcrumb items
const breadcrumbItems = [
  { name: 'Home', url: site },
  { name: 'Thoughts', url: canonicalURL.toString() }
];
---

<Layout title="Thoughts | Thisaru" description="Blog articles by Thisaru on tech, cinema, philosophy, and more.">
  <BreadcrumbSchema items={breadcrumbItems} slot="head" />

  <Header />
  <main id="main-content" role="main" aria-label="Blog posts">
    <section class="py-20 section-fade-in" aria-labelledby="thoughts-heading">
      <div class="container max-w-3xl">
        <h1 id="thoughts-heading" class="heading-1 text-center mb-4 text-text">Thoughts</h1>
        <p class="text-center text-text-muted mb-12 text-lg">
          Exploring technology, cinema, philosophy, and the spaces in between.
        </p>
        <div class="space-y-12">
          {posts.map((post, index) => (
            <article class="group scroll-fade-in-up border-b border-gray-200/20 pb-8 last:border-b-0" style={`animation-delay: ${index * 0.1}s;`}>
              <a 
                href={`/thoughts/${post.slug}/`} 
                class="block focus-ring rounded-lg p-4 -m-4 hover:bg-background-card/50 transition-all duration-300"
                aria-label={`Read article: ${post.data.title}`}
              >
                <h2 class="heading-3 group-hover:text-accent-cyan transition-colors duration-300 mb-3">
                  {post.data.title}
                </h2>
                <p class="text-text-muted mt-2 leading-relaxed">{post.data.description}</p>
                <div class="flex flex-wrap items-center gap-4 mt-4">
                  <time
                    datetime={post.data.pubDate.toISOString()}
                    class="text-sm text-text-muted font-medium"
                  >
                    {post.data.pubDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </time>
                  {post.data.tags && (
                    <div class="flex flex-wrap gap-2">
                      {post.data.tags.map((tag) => (
                        <a 
                          href={`/thoughts/tag/${encodeURIComponent(tag)}/`} 
                          class="text-xs px-2 py-1 bg-accent-orange/10 text-accent-orange rounded-full hover:bg-accent-orange/20 hover:scale-105 transition-all duration-300 focus-ring"
                        >
                          #{tag}
                        </a>
                      ))}
                    </div>
                  )}
                </div>
              </a>
            </article>
          ))}
        </div>
        {posts.length === 0 && (
          <div class="text-center py-16">
            <p class="text-text-muted text-lg">No posts yet. Check back soon!</p>
          </div>
        )}
      </div>
    </section>
  </main>
  <Footer />
</Layout>
